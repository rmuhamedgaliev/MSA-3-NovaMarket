# Реестр событий Saga-хореографии оформления заказа

## Структура события

```json
{
  "eventType": "PaymentSucceeded",
  "sagaId": "saga-123",
  "correlationId": "req-789",
  "timestamp": "2025-01-07T12:34:56Z",
  "payload": {
    "orderId": "order-456",
    "userId": "user-789",
    "amount": 1500,
    "paymentId": "pay-999"
  }
}
```

**Ключевые поля:**
- `eventType` — тип события
- `sagaId` — идентификатор текущей Saga
- `correlationId` — общий ID цепочки вызовов для трассировки
- `payload` — бизнес-данные события

## Успешный сценарий

| Этап | Тип события | Название | Описание |
|------|-------------|----------|----------|
| Создание заказа | domain | OrderCreated | Заказ создан, товары добавлены в корзину |
| Товары в наличии | domain | InventoryAvailable | Товары доступны для резервирования |
| Резервирование товаров | domain | InventoryReserved | Товары зарезервированы на складе |
| Успешная оплата | domain | PaymentSucceeded | Платеж успешно обработан |
| Подтверждение заказа | domain | OrderConfirmed | Заказ подтвержден после успешной оплаты |
| Запрос на доставку | domain | DeliveryRequested | Создана заявка на доставку |
| Уведомление продавца | domain | SellerNotificationSent | Продавец уведомлен о новом заказе |

## Сценарии с ошибками

| Этап | Тип события | Название | Описание |
|------|-------------|----------|----------|
| Недостаточно товаров | failure | InventoryInsufficient | На складе недостаточно товаров |
| Ошибка резервирования | failure | InventoryReservationFailed | Не удалось зарезервировать товары |
| Ошибка платежа | failure | PaymentFailed | Платеж не прошел (недостаточно средств, ошибка карты) |
| Таймаут платежа | timeout | PaymentTimeout | Превышено время ожидания платежа |
| Ошибка доставки | failure | DeliveryRequestFailed | Не удалось создать заявку на доставку |

## Компенсационные действия

| Этап | Тип события | Название | Описание |
|------|-------------|----------|----------|
| Отмена резервирования | compensation | InventoryReleased | Освобождение зарезервированных товаров |
| Возврат средств | compensation | RefundSucceeded | Возврат денежных средств покупателю |
| Отмена заказа | compensation | OrderCancelled | Заказ отменен, все операции откачены |
| Уведомление об ошибке | compensation | ErrorNotificationSent | Покупатель уведомлен об ошибке |

## События статусов

| Этап | Тип события | Название | Описание |
|------|-------------|----------|----------|
| Изменение статуса заказа | domain | OrderStatusChanged | Статус заказа обновлен |
| Обновление статуса доставки | domain | DeliveryStatusChanged | Статус доставки обновлен |
| Товар подготовлен | domain | OrderReadyForShipment | Товар готов к отправке |
| Заказ доставлен | domain | OrderDelivered | Заказ успешно доставлен |
